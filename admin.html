<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - AUTOIMPORT</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <header>
        <div class="logo">AUTOIMPORT</div>
        <nav>
            <ul>
                <li><a href="index.html">Главная</a></li>
                <li><a href="catalog.html">Каталог</a></li>
                <li><a href="about.html">О нас</a></li>
                <li><a href="contacts.html">Контакты</a></li>
                <li><a href="admin.html" class="active">Админ-панель</a></li>
            </ul>
        </nav>
    </header>

    <section class="about-section">
        <div class="content-container">
            <h1>Добавить автомобиль</h1>
            <form id="car-form">
                <label>Марка: <input type="text" name="brand" required></label>
                <label>Модель: <input type="text" name="model" required></label>
                <label>Поколение: <input type="text" name="generation" required></label>
                <label>КПП: <input type="text" name="transmission" required></label>
                <label>Тип двигателя: <input type="text" name="engineType" required></label>
                <label>Год: <input type="number" name="year" required></label>
                <label>Цена ($): <input type="number" name="price" required></label>
                <label>Привод: <input type="text" name="driveType" required></label>
                <label>Пробег (км): <input type="number" name="mileage" required></label>
                <label>Страна: <input type="text" name="country" required></label>
                <label>Изображение (URL): <input type="text" name="image"></label>
                <button type="submit">Добавить автомобиль</button>
            </form>
            <div id="car-result"></div>

            <h2>Заявки</h2>
            <div id="requests-list"></div>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 AUTOIMPORT. Все права защищены.</p>
    </footer>

    <script>
        document.getElementById('car-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const carData = {
                brand: formData.get('brand'),
                model: formData.get('model'),
                generation: formData.get('generation'),
                transmission: formData.get('transmission'),
                engineType: formData.get('engineType'),
                year: parseInt(formData.get('year')),
                price: parseInt(formData.get('price')),
                driveType: formData.get('driveType'),
                mileage: parseInt(formData.get('mileage')),
                country: formData.get('country'),
                image: formData.get('image') || null
            };

            try {
                const auth = btoa('admin:secret'); // Замени на свой логин:пароль
                const response = await fetch('http://localhost:8000/api/cars', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Basic ${auth}`
                    },
                    body: JSON.stringify(carData)
                });
                if (!response.ok) {
                    throw new Error('Ошибка при добавлении автомобиля');
                }
                document.getElementById('car-result').textContent = 'Автомобиль успешно добавлен!';
                this.reset();
            } catch (error) {
                document.getElementById('car-result').textContent = 'Ошибка: ' + error.message;
            }
        });

        // Загрузка заявок
        async function loadRequests() {
            try {
                const auth = btoa('admin:secret'); // Замени на свой логин:пароль
                const response = await fetch('http://localhost:8000/api/requests', {
                    headers: { 'Authorization': `Basic ${auth}` }
                });
                if (!response.ok) {
                    throw new Error('Ошибка при загрузке заявок');
                }
                const requests = await response.json();
                const list = document.getElementById('requests-list');
                list.innerHTML = requests.map(req => `
                    <p><strong>${req.name}</strong> (${req.contact}): ${req.message || 'Нет сообщения'}<br>
                    <small>${new Date(req.created_at).toLocaleString()}</small></p>
                `).join('');
            } catch (error) {
                document.getElementById('requests-list').textContent = 'Ошибка: ' + error.message;
            }
        }
        loadRequests();
    </script>
</body>
</html>